<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirim Data - Mode Offline</title>
    <meta name="description"
        content="Transfer file tanpa internet menggunakan WebRTC. Tukar file langsung antar perangkat.">

    <!-- Modular CSS -->
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/native.css">
    <link rel="stylesheet" href="css/native.css">
    <link rel="stylesheet" href="css/video.css">
    <link rel="stylesheet" href="css/info-panel.css">
</head>

<body>
    <!-- Epic Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <div class="rocket-trail"></div>
            <div class="splash-logo" id="splash-rocket">ğŸ“¡</div>
            <div class="splash-title">
                <span class="hacker-text" data-text="Tanpa Server">Tanpa Server</span>
            </div>
            <div class="splash-loader">
                <div class="loader-bar"></div>
            </div>
        </div>
    </div>

    <div class="page-layout">
        <div class="container" style="text-align: center;">
            <!-- STEP 1: PILIH PERAN -->
            <div id="step-role" class="step active">
                <h1>ğŸ“¡ WebRTC Tanpa Server</h1>
                <p class="subtitle">Transfer file tanpa internet.<br>Tukar tiket untuk terhubung.</p>

                <a href="native-how-it-works.html" class="btn text-link"
                    style="margin-bottom: 1.5rem; display: inline-block; font-size: 0.9rem;">
                    ğŸ¤” Bagaimana cara kerjanya?
                </a>

                <button class="btn" onclick="startHost()">
                    <span>ğŸ“¤ Saya Pengirim</span>
                </button>
                <button class="btn secondary" onclick="startJoiner()">
                    <span>ğŸ“¥ Saya Penerima</span>
                </button>
            </div>

            <!-- HOST STEP 1: LOADING -->
            <div id="host-step-1" class="step">
                <h1>â³ Membuat Tiket</h1>
                <p class="subtitle">Tunggu sebentar...</p>

                <div class="waiting-animation">
                    <div class="loader">â³</div>
                    <p class="waiting-text">Sedang menyiapkan tiket undangan...</p>
                </div>
            </div>

            <!-- HOST STEP 2: DOWNLOAD & UPLOAD TICKET -->
            <div id="host-step-2" class="step">
                <h1>ğŸ“¤ Langkah 1/2</h1>
                <p class="subtitle">Salin & kirim tiket undangan ke teman</p>

                <div class="manual-area visible">
                    <p>1. Salin kode ini & kirim (WA/Chat):</p>
                    <textarea id="host-offer-text" readonly onclick="this.select()"></textarea>
                    <button class="btn" onclick="copyToClipboard('host-offer-text')">ğŸ“‹ Salin ke Clipboard</button>
                </div>

                <button class="btn text-link secondary-option" onclick="toggleManual('host-file-area')">
                    Atau gunakan file JSON (Opsi lain) â–¼
                </button>

                <div id="host-file-area" class="manual-area">
                    <button class="btn download" onclick="downloadTicket('offer')">
                        ğŸ“¥ Unduh Tiket sebagai File .JSON
                    </button>
                </div>

                <hr class="step-divider">

                <h3>ğŸ“¥ Selanjutnya</h3>
                <p class="subtitle" style="margin-bottom: 1rem;">Tempel tiket balasan dari teman</p>

                <div class="manual-area visible">
                    <textarea id="host-answer-input" placeholder="2. Tempel kode balasan teman di sini..."></textarea>
                    <button class="btn" onclick="handleManualText('answer', 'host-answer-input')">
                        Proses Koneksi
                    </button>
                </div>

                <button class="btn text-link secondary-option" onclick="toggleManual('host-upload-area')">
                    Atau upload file balasan .JSON â–¼
                </button>

                <div id="host-upload-area" class="manual-area">
                    <div class="drop-zone" id="host-drop" onclick="triggerUpload('host-upload')">
                        <span class="icon-large">ğŸ“‚</span>
                        <p>Klik atau tarik file "tiket-balasan.json"</p>
                    </div>
                    <input type="file" id="host-upload" accept=".json" onchange="handleFileUpload(this, 'answer')">
                </div>
            </div>

            <!-- JOINER STEP 1: UPLOAD TICKET -->
            <div id="joiner-step-1" class="step">
                <h1>ğŸ“¥ Langkah 1/2</h1>
                <p class="subtitle">Tempel kode undangan dari pengirim</p>

                <div class="manual-area visible">
                    <textarea id="join-offer-input" placeholder="Tempel kode undangan teman di sini..."></textarea>
                    <button class="btn" onclick="handleManualText('offer', 'join-offer-input')">
                        Proses Kode
                    </button>
                </div>

                <button class="btn text-link secondary-option" onclick="toggleManual('join-upload-area')">
                    Atau upload file undangan .JSON â–¼
                </button>

                <div id="join-upload-area" class="manual-area">
                    <div class="drop-zone" id="join-drop" onclick="triggerUpload('join-upload-offer')">
                        <span class="icon-large">ğŸ“¨</span>
                        <p>Klik atau tarik file "tiket-undangan.json"</p>
                    </div>
                    <input type="file" id="join-upload-offer" accept=".json" onchange="handleFileUpload(this, 'offer')">
                </div>

                <button class="btn secondary" onclick="showStep('step-role', 'left')">â† Kembali</button>
            </div>

            <!-- JOINER STEP 2: DOWNLOAD ANSWER -->
            <div id="joiner-step-2" class="step">
                <h1>ğŸ“¤ Langkah 2/2</h1>
                <p class="subtitle">Kirim kode balasan ke pengirim</p>

                <div class="ticket-status">
                    <span class="icon">âœ…</span>
                    Kode Balasan Siap!
                </div>

                <div class="manual-area visible">
                    <p>Salin kode balasan ini & kirim balik:</p>
                    <textarea id="join-answer-text" readonly onclick="this.select()"></textarea>
                    <button class="btn" onclick="copyToClipboard('join-answer-text')">ğŸ“‹ Salin ke Clipboard</button>
                </div>

                <button class="btn text-link secondary-option" onclick="toggleManual('join-file-area')">
                    Atau unduh file .JSON â–¼
                </button>

                <div id="join-file-area" class="manual-area">
                    <button class="btn download" onclick="downloadTicket('answer')">
                        ğŸ“¥ Unduh Tiket Balasan
                    </button>
                </div>

                <div class="waiting-animation" style="margin-top: 1rem;">
                    <div class="radar-container">
                        <div class="radar-wave"></div>
                        <div class="radar-wave"></div>
                        <div class="radar-wave"></div>
                        <div class="radar-center"></div>
                    </div>
                    <p class="waiting-text">Menunggu pengirim memproses...</p>
                </div>
            </div>

            <!-- CHAT ROOM -->
            <div id="step-chat" class="step">
                <div class="connected-badge">
                    <span class="connected-dot"></span>
                    Terhubung - Siap kirim file!
                </div>

                <div class="chat-container" id="chat-zone">
                    <div class="chat-box" id="msgs">
                        <div class="msg system">
                            âœ… <b>Berhasil terhubung!</b><br>
                            Kirim pesan, tarik file, atau paste gambar.
                        </div>
                    </div>

                    <!-- Drag & Drop Overlay -->
                    <div id="drag-overlay" class="drag-overlay" style="display: none;">
                        <div class="drag-content">
                            <span class="emoji">ğŸ“‚</span>
                            Lepaskan file di sini
                        </div>
                    </div>

                    <div class="chat-input">
                        <input type="text" id="msgInput" placeholder="Tulis pesan..."
                            onkeypress="if(event.key==='Enter') sendMsg()">
                        <button class="btn btn-video" onclick="NativeVideo.startCall()" title="Video Call">ğŸ“¹</button>
                        <button class="btn send-btn" onclick="sendMsg()">â¤</button>
                    </div>
                </div>

                <label for="fileTransferInput">ğŸ“ Kirim file (klik, drag & drop, atau paste)</label>
                <input type="file" id="fileTransferInput" multiple style="display: none;"
                    onchange="sendFileTransferManual()">

                <!-- Toggle Button for Info Panel -->
                <button class="info-toggle-btn" id="info-toggle-btn" onclick="toggleInfoPanel()">
                    <span>ğŸ“Š Tampilkan Informasi</span>
                    <span class="toggle-icon">â–¼</span>
                </button>

                <div style="text-align: center; margin-top: 1rem;">
                    <button class="btn secondary danger" onclick="resetApp()"
                        style="width: auto; padding: 8px 20px; font-size: 0.85rem;">
                        Keluar Room
                    </button>
                </div>
            </div>


        </div>
        <!-- Information Panel -->
        <div class="info-panel" id="info-panel">
            <div class="info-panel-header">
                <h3>ğŸ“Š Informasi Tambahan</h3>
            </div>

            <!-- Status Koneksi -->
            <div class="info-card">
                <div class="info-card-header">
                    <span class="card-icon">ğŸ”Œ</span>
                    Status Koneksi
                </div>
                <div class="status-item">
                    <span class="status-label">Status</span>
                    <span class="status-value" id="info-status">
                        <span class="status-dot connecting"></span>
                        Menunggu...
                    </span>
                </div>
                <div class="status-item">
                    <span class="status-label">Role</span>
                    <span class="status-value" id="info-role">-</span>
                </div>
            </div>

            <!-- Statistik Transfer -->
            <div class="info-card">
                <div class="info-card-header">
                    <span class="card-icon">ğŸ“ˆ</span>
                    Statistik Transfer
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="stat-bytes-sent">0 B</div>
                        <div class="stat-label">Dikirim</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-bytes-recv">0 B</div>
                        <div class="stat-label">Diterima</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-files-sent">0</div>
                        <div class="stat-label">File Kirim</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-files-recv">0</div>
                        <div class="stat-label">File Terima</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-msg-sent">0</div>
                        <div class="stat-label">Pesan Kirim</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-msg-recv">0</div>
                        <div class="stat-label">Pesan Terima</div>
                    </div>
                </div>
            </div>

            <!-- Log Aktivitas -->
            <div class="info-card">
                <div class="info-card-header">
                    <span class="card-icon">ğŸ“</span>
                    Log Aktivitas
                </div>
                <div class="activity-log" id="activity-log">
                    <div class="empty-log">Belum ada aktivitas</div>
                </div>
            </div>
        </div>
        <!-- Video Call Overlay -->
        <div id="video-overlay" class="video-overlay">
            <div class="remote-video-container">
                <video id="remote-video" autoplay playsinline></video>
                <div class="local-video-container">
                    <video id="local-video" autoplay muted playsinline></video>
                </div>
            </div>
            <div class="video-controls">
                <!-- <button id="btn-quality" class="video-btn" onclick="NativeVideo.toggleQuality()"
                    title="Ganti Kualitas (Eco/HD)">âš¡</button> -->
                <button id="btn-switch-cam" class="video-btn" onclick="NativeVideo.switchCamera()"
                    title="Ganti Kamera">ğŸ”„</button>
                <button id="btn-toggle-mic" class="video-btn" onclick="NativeVideo.toggleAudio()">ğŸ¤</button>
                <button id="btn-hangup" class="video-btn hangup" onclick="NativeVideo.endCall()">ğŸ“</button>
                <button id="btn-toggle-cam" class="video-btn" onclick="NativeVideo.toggleVideo()">ğŸ“¹</button>
            </div>
        </div>

        <!-- Incoming Call Modal -->
        <div id="incoming-call-modal" class="incoming-call-modal">
            <div class="call-pulse"></div>
            <div class="caller-info">
                <div>ğŸ“ Panggilan Masuk...</div>
                <div style="font-size: 0.8em; opacity: 0.8;" id="incoming-caller-id">Teman</div>
            </div>
            <div class="call-actions">
                <button class="btn-reject" onclick="rejectNativeCall()">âœ–</button>
                <button class="btn-accept" onclick="acceptNativeCall()">âœ”</button>
            </div>
        </div>
    </div>

    <!-- Copy Toast Notification -->
    <div id="copy-toast" class="copy-toast">Salin Berhasil! âœ…</div>

    <!-- Modular JavaScript -->
    <script src="js/entrance.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/native-video.js"></script>
    <script src="js/file-transfer.js"></script>
    <script src="js/input-handlers.js"></script>
    <script src="js/native-app.js"></script>
</body>

</html>