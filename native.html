<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirim Data (Offline Mode)</title>

    <!-- Modular CSS -->
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/native.css">
</head>

<body>
    <div class="container" style="text-align: center;">
        <h1>ğŸ“¡ Kirim Data Offline</h1>
        <p class="subtitle">Tanpa Internet, Tanpa Server. Tukar File atau Copy-Paste.</p>

        <!-- STEP 1: PILIH PERAN -->
        <div id="step-role" class="step active">
            <button class="btn" onclick="startHost()"><span>ğŸ“¤ Saya Pengirim (Host)</span></button>
            <button class="btn secondary" onclick="startJoiner()"><span>ğŸ“¥ Saya Penerima (Joiner)</span></button>
        </div>

        <!-- HOST STEP 1: LOADING -->
        <div id="host-step-1" class="step">
            <p>1. Sistem sedang membuat Tiket...</p>
            <div class="drop-zone" style="border:none; background:transparent;">
                <div class="loader">â³</div>
            </div>
        </div>

        <!-- HOST STEP 2: DOWNLOAD & UPLOAD TICKET -->
        <div id="host-step-2" class="step">
            <h3>Langkah 1 dari 2</h3>
            <p><b>Opsi A:</b> Download file Tiket & kirim ke teman.</p>
            <button class="btn download" onclick="downloadTicket('offer')">Saved "tiket-undangan.json"</button>

            <button class="btn text-link" onclick="toggleManual('host-manual-offer')">Atau salin kode teks manual
                (Copy-Paste)</button>
            <div id="host-manual-offer" class="manual-area">
                <p style="font-size:0.8rem; margin:0 0 5px 0;">Salin kode ini:</p>
                <textarea id="host-offer-text" readonly onclick="this.select()"></textarea>
            </div>

            <hr style="margin: 1.5rem 0; border:none; border-top:1px solid #eee;">

            <p><b>Langkah Selanjutnya:</b> Terima Tiket Balasan dari teman.</p>
            <div class="drop-zone" id="host-drop" onclick="triggerUpload('host-upload')">
                <span class="icon-large">ğŸ“‚</span>
                <p>Klik / Tarik File "tiket-balasan.json"</p>
            </div>
            <input type="file" id="host-upload" accept=".json" onchange="handleFileUpload(this, 'answer')">

            <button class="btn text-link" onclick="toggleManual('host-manual-answer')">Input manual kode
                balasan</button>
            <div id="host-manual-answer" class="manual-area">
                <textarea id="host-answer-input" placeholder="Tempel kode balasan di sini..."></textarea>
                <button class="btn" onclick="handleManualText('answer', 'host-answer-input')">Proses Kode</button>
            </div>
        </div>

        <!-- JOINER STEP 1: UPLOAD TICKET -->
        <div id="joiner-step-1" class="step">
            <h3>Langkah 1 dari 2</h3>
            <p>Minta Tiket Undangan dari Host.</p>

            <div class="drop-zone" id="join-drop" onclick="triggerUpload('join-upload-offer')">
                <span class="icon-large">ğŸ“¨</span>
                <p>Klik / Tarik File "tiket-undangan.json"</p>
            </div>
            <input type="file" id="join-upload-offer" accept=".json" onchange="handleFileUpload(this, 'offer')">

            <button class="btn text-link" onclick="toggleManual('join-manual-offer')">Input manual kode
                undangan</button>
            <div id="join-manual-offer" class="manual-area">
                <textarea id="join-offer-input" placeholder="Tempel kode undangan Host di sini..."></textarea>
                <button class="btn" onclick="handleManualText('offer', 'join-offer-input')">Proses Kode</button>
            </div>
        </div>

        <!-- JOINER STEP 2: DOWNLOAD ANSWER -->
        <div id="joiner-step-2" class="step">
            <h3>Langkah 2 dari 2</h3>
            <p>Tiket Balasan siap! Kirim kembali ke Host.</p>

            <button class="btn download" onclick="downloadTicket('answer')">Saved "tiket-balasan.json"</button>

            <button class="btn text-link" onclick="toggleManual('join-manual-answer')">Atau salin kode balasan
                manual</button>
            <div id="join-manual-answer" class="manual-area">
                <p style="font-size:0.8rem; margin:0 0 5px 0;">Salin kode balasan ini:</p>
                <textarea id="join-answer-text" readonly onclick="this.select()"></textarea>
            </div>

            <p class="subtitle" style="margin-top:1rem;">Menunggu Host memproses...</p>
        </div>

        <!-- CHAT ROOM -->
        <div id="step-chat" class="step">
            <div class="chat-container" id="chat-zone">
                <div class="chat-messages" id="msgs">
                    <div class="msg system">
                        âœ… <b>Koneksi Berhasil!</b><br>
                        Silakan Chat, Drag File, atau Paste Gambar.
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="msgInput" placeholder="Ketik pesan..."
                        onkeypress="if(event.key==='Enter') sendMsg()">
                    <button class="btn" style="width: auto; padding: 5px 15px; margin:0;" onclick="sendMsg()">â¤</button>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 1rem;">
                <button class="btn secondary" onclick="document.getElementById('fileTransferInput').click()">ğŸ“ Kirim
                    File</button>
                <button class="btn secondary" style="border-color: #ef4444; color: #ef4444;"
                    onclick="resetApp()">Keluar</button>
            </div>
            <input type="file" id="fileTransferInput" multiple onchange="sendFileTransferManual()">
        </div>
    </div>

    <!-- Modular JavaScript -->
    <script src="js/utils.js"></script>
    <script src="js/file-transfer.js"></script>
    <script src="js/input-handlers.js"></script>
    <script src="js/native-app.js"></script>
</body>

</html>